<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geo-tag Photo with Location</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        video {
            width: 100%;
            height: auto;
            border-radius: 0.75rem;
        }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-dot {
            animation: pulse-dot 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .mock-w3w {
            background: linear-gradient(45deg, #4F46E5, #7E22CE);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-lg mx-auto bg-gray-800 rounded-2xl shadow-2xl overflow-hidden">
        <div class="p-6">
            <header class="text-center mb-6">
                <h1 class="text-2xl font-bold text-white">Tokenopoly Geo-Tag</h1>
                <p class="text-gray-400 text-sm">Capture photos for the W3W block challenge</p>
            </header>
            
            <main>
                <div id="initialState" class="text-center">
                    <button id="takePhotoButton" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-500/50 flex items-center justify-center mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle></svg>
                        Start Camera
                    </button>
                </div>

                <div id="cameraState" class="hidden">
                    <div class="bg-black rounded-xl overflow-hidden shadow-lg mb-4 relative">
                        <video id="video" autoplay playsinline></video>
                        <div id="cameraSpinner" class="absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center">
                            <svg class="animate-spin h-10 w-10 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                    </div>
                     <canvas id="canvas" class="hidden"></canvas>
                    <button id="captureButton" class="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-500/50 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><circle cx="12" cy="12" r="10"></circle></svg>
                        Capture Photo
                    </button>
                </div>

                <div id="resultState" class="hidden space-y-4">
                    <img id="photo" src="" alt="Captured photo" class="rounded-xl shadow-lg w-full">
                    
                    <div id="status" class="flex items-center justify-center space-x-2 bg-gray-700/50 p-3 rounded-lg">
                        <div class="h-2.5 w-2.5 bg-yellow-400 rounded-full pulse-dot"></div>
                        <span id="statusText" class="text-sm font-medium text-yellow-300">Getting location...</span>
                    </div>

                    <div id="locationInfo" class="hidden bg-gray-700/50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-white mb-2">Location Details</h3>
                        <div class="space-y-2 text-sm">
                            <p>
                                <strong class="text-indigo-400">W3W Block:</strong>
                                <span id="w3w" class="mock-w3w ml-2 p-1 bg-gray-900 rounded">///</span>
                            </p>
                            <p>
                                <strong class="text-indigo-400">Coordinates:</strong>
                                <span id="coords" class="font-mono ml-2 p-1 bg-gray-900 rounded">...</span>
                            </p>
                            <p>
                                <strong class="text-indigo-400">Block ID:</strong>
                                <span id="blockId" class="font-mono ml-2 p-1 bg-gray-900 rounded">ATL-</span>
                            </p>
                        </div>
                        <div class="mt-4 p-3 bg-yellow-900/20 rounded-lg">
                            <p class="text-xs text-yellow-300">
                                üìç <strong>Tokenopoly Challenge:</strong> Use this location to create your viral TikTok reel!
                            </p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <a id="downloadButton" href="#" download="tokenopoly-photo.jpg" class="hidden w-full bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg text-center transition focus:outline-none focus:ring-2 focus:ring-green-500/50">Download Photo</a>
                        <button id="resetButton" class="w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-gray-500/50">Take Another</button>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script>
        const initialState = document.getElementById('initialState');
        const cameraState = document.getElementById('cameraState');
        const resultState = document.getElementById('resultState');
        const takePhotoButton = document.getElementById('takePhotoButton');
        const captureButton = document.getElementById('captureButton');
        const resetButton = document.getElementById('resetButton');
        const downloadButton = document.getElementById('downloadButton');
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const photo = document.getElementById('photo');
        const status = document.getElementById('status');
        const statusText = document.getElementById('statusText');
        const cameraSpinner = document.getElementById('cameraSpinner');
        const locationInfo = document.getElementById('locationInfo');
        const w3wElement = document.getElementById('w3w');
        const coordsElement = document.getElementById('coords');
        const blockIdElement = document.getElementById('blockId');
        
        let stream = null;
        let currentPosition = null;

        // Mock W3W words for demonstration
        const mockW3WWords = [
            'viral.tokemon.trend', 'atlanta.block.party', 'token.winner.champ',
            'tiktok.boost.fame', 'influence.create.share', 'content.creator.zone',
            'geotag.capture.win', 'challenge.accepted.go', 'block.battle.royale',
            'metro.atl.spotlight', 'dcommerce.hub.local', 'stream.shop.engage'
        ];

        function initialize() {
            takePhotoButton.addEventListener('click', startCamera);
            captureButton.addEventListener('click', capturePhoto);
            resetButton.addEventListener('click', resetApp);
        }

        async function startCamera() {
            initialState.classList.add('hidden');
            resultState.classList.add('hidden');
            cameraState.classList.remove('hidden');
            cameraSpinner.style.display = 'flex';

            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' }
                });
                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    cameraSpinner.style.display = 'none';
                };
                
                // Get location in background
                getCurrentLocation();
            } catch (err) {
                console.error("Error accessing media devices.", err);
                updateStatus('Camera access was denied.', 'error');
                cameraState.classList.add('hidden');
                initialState.classList.remove('hidden');
            }
        }
        
        function getCurrentLocation() {
            if (!navigator.geolocation) {
                console.warn('Geolocation is not supported by your browser.');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    currentPosition = position;
                },
                (error) => {
                    console.warn("Geolocation error:", error);
                    // Continue without location - we'll use mock data
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }
        
        function capturePhoto() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const dataUrl = canvas.toDataURL('image/jpeg');
            photo.src = dataUrl;
            downloadButton.href = dataUrl;
            downloadButton.classList.remove('hidden');
            cameraState.classList.add('hidden');
            resultState.classList.remove('hidden');
            stopCameraStream();
            
            // Generate location data without API calls
            generateLocationData();
        }

        function generateLocationData() {
            updateStatus('Generating location data...', 'loading');

            setTimeout(() => {
                if (currentPosition) {
                    const { latitude, longitude } = currentPosition.coords;
                    coordsElement.textContent = `${latitude.toFixed(5)}, ${longitude.toFixed(5)}`;
                    
                    // Generate mock W3W address based on coordinates
                    const mockW3W = generateMockW3W(latitude, longitude);
                    w3wElement.textContent = `///${mockW3W}`;
                    
                    // Generate block ID
                    const blockId = generateBlockId(latitude, longitude);
                    blockIdElement.textContent = blockId;
                } else {
                    // Use fallback mock data if no GPS available
                    coordsElement.textContent = "33.74900, -84.38800"; // Atlanta center
                    const randomW3W = mockW3WWords[Math.floor(Math.random() * mockW3WWords.length)];
                    w3wElement.textContent = `///${randomW3W}`;
                    blockIdElement.textContent = "ATL-" + Math.random().toString(36).substr(2, 6).toUpperCase();
                }
                
                updateStatus('Location ready for Tokenopoly!', 'success');
            }, 1500); // Simulate API delay
        }

        function generateMockW3W(lat, lon) {
            // Create deterministic but fun W3W-like addresses based on coordinates
            const latStr = Math.abs(lat).toFixed(3).replace('.', '');
            const lonStr = Math.abs(lon).toFixed(3).replace('.', '');
            
            const words1 = ['viral', 'token', 'tiktok', 'atlanta', 'block', 'metro', 'creator', 'content'];
            const words2 = ['monopoly', 'challenge', 'battle', 'spotlight', 'hub', 'zone', 'party', 'game'];
            const words3 = ['win', 'trend', 'fame', 'boost', 'engage', 'share', 'create', 'capture'];
            
            const index1 = parseInt(latStr.substr(0, 2)) % words1.length;
            const index2 = parseInt(lonStr.substr(0, 2)) % words2.length;
            const index3 = (parseInt(latStr.substr(2, 2)) + parseInt(lonStr.substr(2, 2))) % words3.length;
            
            return `${words1[index1]}.${words2[index2]}.${words3[index3]}`;
        }

        function generateBlockId(lat, lon) {
            const gridX = Math.floor((lon + 180) / 0.0009); // ~100m blocks
            const gridY = Math.floor((lat + 90) / 0.0009);
            return `ATL-${gridX.toString(36).substr(0, 3)}-${gridY.toString(36).substr(0, 3)}`.toUpperCase();
        }
        
        function updateStatus(message, type) {
            statusText.textContent = message;
            const dot = status.querySelector('.pulse-dot');
            dot.classList.remove('bg-yellow-400', 'bg-green-400', 'bg-red-400', 'text-yellow-300', 'text-green-300', 'text-red-300');
            
            if (type === 'loading') {
                dot.classList.add('bg-yellow-400');
                statusText.classList.add('text-yellow-300');
                status.classList.remove('hidden');
                locationInfo.classList.add('hidden');
            } else if (type === 'success') {
                dot.classList.add('bg-green-400');
                statusText.classList.add('text-green-300');
                status.classList.add('hidden');
                locationInfo.classList.remove('hidden');
            } else if (type === 'error') {
                dot.classList.add('bg-red-400');
                statusText.classList.add('text-red-300');
                status.classList.remove('hidden');
                locationInfo.classList.add('hidden');
            }
        }
        
        function stopCameraStream() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
        }

        function resetApp() {
            stopCameraStream();
            resultState.classList.add('hidden');
            cameraState.classList.add('hidden');
            initialState.classList.remove('hidden');
            photo.src = '';
            downloadButton.href = '#';
            downloadButton.classList.add('hidden');
            w3wElement.textContent = '///';
            coordsElement.textContent = '...';
            blockIdElement.textContent = 'ATL-';
            currentPosition = null;
        }

        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
